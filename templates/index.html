<!DOCTYPE html>
<html>
<head>
<title>Agent Performance Report</title>
<style>
body{
font-family:Segoe UI;
background:#0f172a;
color:white;
padding:30px;
}
.box{
background:#020617;
padding:25px;
border-radius:12px;
max-width:1200px;
margin:auto;
box-shadow:0 0 15px #38bdf8;
}
input,button{
padding:10px;
border-radius:6px;
border:none;
margin:5px;
}
button{
background:#38bdf8;
color:black;
font-weight:bold;
cursor:pointer;
}
table{
width:100%;
border-collapse:collapse;
margin-top:20px;
}
th,td{
border:1px solid #334155;
padding:8px;
text-align:center;
}
th{
background:#020617;
color:#38bdf8;
}
</style>
</head>
<body>

<div class="box">
<h2>Agent Performance Generator</h2>

<input type="file" id="agent">
<input type="file" id="cdr">
<br>
<button onclick="generate()">Generate Report</button>
<button onclick="reset()">Reset</button>
<button onclick="exportExcel()">Export Excel</button>

<div id="table"></div>
</div>

<script>
let reportData=[];

function generate(){
let f=new FormData();
f.append("agent",document.getElementById("agent").files[0]);
f.append("cdr",document.getElementById("cdr").files[0]);

fetch("/process",{method:"POST",body:f})
.then(r=>r.json())
.then(d=>{
reportData=d;
drawTable(d);
});
}

function drawTable(d){
let h="<table><tr>";
Object.keys(d[0]).forEach(k=>h+="<th>"+k+"</th>");
h+="</tr>";
d.forEach(r=>{
h+="<tr>";
Object.values(r).forEach(v=>h+="<td>"+v+"</td>");
h+="</tr>";
});
h+="</table>";
document.getElementById("table").innerHTML=h;
}

function exportExcel(){
fetch("/export",{method:"POST",body:JSON.stringify(reportData)})
.then(r=>r.blob())
.then(b=>{
let a=document.createElement("a");
a.href=URL.createObjectURL(b);
a.download="Final_Report.xlsx";
a.click();
});
}

function reset(){
document.getElementById("agent").value="";
document.getElementById("cdr").value="";
document.getElementById("table").innerHTML="";
reportData=[];
}
</script>

</body>
</html>
