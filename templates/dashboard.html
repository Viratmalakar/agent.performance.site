<!DOCTYPE html>
<html>
<head>
<title>Dashboard</title>
</head>
<body>

<h2>Agent Dashboard</h2>

<form id="frm" enctype="multipart/form-data">
    <input type="file" name="agent" required><br><br>
    <input type="file" name="cdr" required><br><br>
    <button type="submit">Generate</button>
</form>

<table border="1" id="tbl"></table>

<script>
document.getElementById("frm").addEventListener("submit",function(e){
    e.preventDefault();

    let fd = new FormData(this);

    fetch("/process",{
        method:"POST",
        body:fd
    })
    .then(r=>r.json())
    .then(data=>{
        let t=document.getElementById("tbl");
        t.innerHTML="";

        let h="<tr>";
        Object.keys(data[0]).forEach(k=>h+="<th>"+k+"</th>");
        h+="</tr>";
        t.innerHTML=h;

        data.forEach(r=>{
            let row="<tr>";
            Object.values(r).forEach(v=>row+="<td>"+v+"</td>");
            row+="</tr>";
            t.innerHTML+=row;
        });
    });
});
</script>

</body>
</html>
