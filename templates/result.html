<!DOCTYPE html>
<html>
<head>
<title>Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
body{font-family:Segoe UI;background:#ecfdf5}
header{text-align:center;font-size:26px;color:#065f46;padding:15px}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;padding:15px}
.card{background:#065f46;color:white;padding:12px;border-radius:10px;text-align:center}

input{margin:10px;padding:8px;width:300px}

.table-box{margin:15px;background:white;border-radius:12px;padding:10px}
.scroll{max-height:600px;overflow:auto}

table{width:100%;border-collapse:collapse}
th{background:#065f46;color:white;padding:8px;position:sticky;top:0}
td{padding:6px;border-bottom:1px solid #ddd;text-align:center}

.redcell{background:#ffdddd;color:navy;font-weight:bold}

.buttons{text-align:center;margin:15px}
button{background:#065f46;color:white;border:none;padding:10px 18px;border-radius:8px;margin:5px}
</style>
</head>

<body>

<header>Agent Performance Dashboard</header>

<div class="cards">
<div class="card">TOTAL IVR HIT<br>{{gt["TOTAL IVR HIT"]}}</div>
<div class="card">TOTAL MATURE<br>{{gt["TOTAL MATURE"]}}</div>
<div class="card">IB MATURE<br>{{gt["IB MATURE"]}}</div>
<div class="card">OB MATURE<br>{{gt["OB MATURE"]}}</div>
<div class="card">TOTAL TALK<br>{{gt["TOTAL TALK TIME"]}}</div>
<div class="card">AHT<br>{{gt["AHT"]}}</div>
<div class="card">LOGIN COUNT<br>{{gt["LOGIN COUNT"]}}</div>
</div>

<center>
<input type="text" id="search" placeholder="Search Agent Full Name..." onkeyup="filterTable()">
</center>

<div class="table-box" id="tableArea">
<div class="scroll">
<table id="table">
<tr>
<th>Agent Name</th><th>Agent Full Name</th><th>Total Login Time</th>
<th>Total Net Login</th><th>Total Break</th><th>Total Meeting</th>
<th>AHT</th><th>Total Call</th><th>IB Mature</th><th>OB Mature</th>
</tr>

{% for r in data %}
<tr>
<td>{{r["Agent Name"]}}</td>
<td>{{r["Agent Full Name"]}}</td>
<td>{{r["Total Login Time"]}}</td>

<td class="{% if r['__red_net'] %}redcell{% endif %}">{{r["Total Net Login"]}}</td>
<td class="{% if r['__red_break'] %}redcell{% endif %}">{{r["Total Break"]}}</td>
<td class="{% if r['__red_meet'] %}redcell{% endif %}">{{r["Total Meeting"]}}</td>

<td>{{r["AHT"]}}</td>
<td>{{r["Total Call"]}}</td>
<td>{{r["IB Mature"]}}</td>
<td>{{r["OB Mature"]}}</td>
</tr>
{% endfor %}
</table>
</div>
</div>

<div class="buttons">
<button onclick="copyImage()">Copy Table</button>
<button onclick="location.reload()">Reset</button>
</div>

<script>
function filterTable(){
let v=document.getElementById("search").value.toLowerCase();
let rows=document.querySelectorAll("#table tr");
rows.forEach((r,i)=>{
if(i==0)return;
r.style.display=r.cells[1].innerText.toLowerCase().includes(v)?"":"none";
});
}

function copyImage(){
html2canvas(document.getElementById("tableArea"),{scale:2}).then(c=>{
c.toBlob(b=>{
navigator.clipboard.write([new ClipboardItem({"image/png":b})]);
alert("Table copied as image");
});
});
}
</script>

</body>
</html>
